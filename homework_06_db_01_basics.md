# devops-netology DEVSYS-PDC-2

### DEVSYS-PDC-2 sysadmin 06.01 Vladimir Baksheev / Владимир Бакшеев Домашнее задание к занятию «6.1. Типы и структура СУБД»

# Домашнее задание к занятию "6.1. Типы и структура СУБД"

## Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определенных данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- Электронные чеки в json виде
- Склады и автомобильные дороги для логистической компании
- Генеалогические деревья
- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации
- Отношения клиент-покупка для интернет-магазина

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

```answer1
Олного правильного ответа не существует - всегда могут найтись нюансы, 
которые сделают "выбор большинства" не подходящим именно для вашей 
задачи, но я попробую подобрать подходящие варианты, как я их понимаю.
```
| Типы сущностей | Варианты СУБД |
| --- | --- |
| - Электронные чеки в json виде | Первое, что приходит на ум и прямо указывалось в качестве примера в материалах лекции - NoSQL Документоориентированная БД. Но суть любого чека - отражение факта покупки, то есть может быть разложено и на составляющие для классической реляционной БД для последующей работы с различными выборками данных.|
| - Склады и автомобильные дороги для логистической компании | Не понимаю что такое "автомобильные дороги для логистической компании", но полагаю, что это фиксированный перечень складских помещений/организаций и такой же фиксированный перечень трасс, используемых для перемещения грузов с/на эти склады. В наиболее широком смысле доставка может быть из любого склада на любой склад и такая структура представляется в виде графов - можно использовать соответствующую графовую БД (это интересно, никогда не видел примеров таких). Альтернативным вариантом является еще сетевая, когда допустимо иметь несколько вершинных связей между объектами тоже. Либо, классически, денормализовать все объекты до связанных таблиц и хранить все данные соответствующим образом в реляционной БД (перечень складов, складских запасов, машин, дорог/маршрутов и их текущее положение, история во времени и т.п.) |
| - Генеалогические деревья | Генеалогия - значит деревья с одним родителем, иерархическая БД |
| - Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации | Ключ - значение в быстрой (но не такой надежной) run-in-memory БД, такой как Redis. Вообще, услышал впервые про Redis именно как про "быстрый способ закешировать наборы данных" для ускорения работы. |
| - Отношения клиент-покупка для интернет-магазина | Как и в первом случае - можно попробовать использовать документоориентированную БД (если важна аналитика, data lake, выгруженные из множества разношерстных источников данных, а не сами структурированные детали по каждому клиенту/заказу в отдельности), но, например, для интернет-магазина важен полный контроль и учет (например частичные/полные возвраты обеспечить, собрать сумму продаж по определенным категориям, а не только за период и т.п.) - лучше всего подойдет классическая реляционная БД с продуманным разбиением данных на связанные таблицы. |


## Задача 2

Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

- Данные записываются на все узлы с задержкой до часа (асинхронная запись)
- При сетевых сбоях, система может разделиться на 2 раздельных кластера
- Система может не прислать корректный ответ или сбросить соединение

А согласно PACELC-теореме, как бы вы классифицировали данные реализации?

```answer2
У меня нет такого опыта - пытаюсь строить выводы и принимать решение 
умозрительно, отталкиваясь только от полученного описания.
Очень помогло понять PACELC описание из документа
https://www.ijcaonline.org/archives/volume151/number10/patinge-2016-ijca-911921.pdf
```
| Вариант | Классификация CAP | Классификация PACELC |
| --- | --- | --- |
| - Данные записываются на все узлы с задержкой до часа (асинхронная запись) | Partition и Availability - PA. Задержка с обновлением данных "до часа" означает неконсистентность данных на всех узлах (в один момент времени данные могут быть разными на разных узлах), при этом разделение на партиции подразумевается возможным - данные синхронизируются с задержкой/позднее. | PA-EL - else - latency, то есть упор на скорость ответа, а не консистентность данных на всех узлах. |
| - При сетевых сбоях, система может разделиться на 2 раздельных кластера | Partition и Availability - PA. Возможность корректной работы (и доступности) системы при разделении на две партции. | PA-EC - else consistency. При условии отсутствия разделения на партиции подразумеваем высокую консистентность данных между всеми узлами. Иначе, если бы упор делали на низкую latency, то такие системы стоили очень дорого - ресурсоёмкие и ограниченные возможности по территориальной распределённости между узлами |
| - Система может не прислать корректный ответ или сбросить соединение | Consistency Availability - CA. "Некорректный ответ" - это все-таки ответ, то есть система "доступна" (available), но, например, из-за разделения на партиции система для поддержания консистентности - вынуждена возвращать ответ с кодом ошибки или сбрасывать подключение (ответ не содержал корректную/полезную и правильную информацию) | PC-EC - else consistency. При разделении - недоступна (нет Availability), а иначе (пока нет разделения на партиции) - система делает упор на целостности/консистентности данных (consistency), жертвуя задержками (latency) |

```answer2-1
Я исправил свои ответы после возвращения на доработку - опирался только на 
подсказку из чата в Телеграм, так как нет единого общепризнанного 
источника, который бы позволил однозначно привести к той или иной логике 
предложенные системы из описания задачи. К тому же сами описания яаляются 
далеко не исчерпывающими и можно трактовать "так" или "иначе", то есть 
приведенные варианты также не являются окончательными, а всего лишь 
плодом измышлений в определнной ситуации.

Особенно сложно было с третьей системой, где "сбросить соеднинение" - 
это все еще available, но "не работает штатным образом"

В первом описании также была сложность с тем, что "задержка до часа" 
подразумевала отсутствие консистентности. В моем словаре не зватало 
такой связи-пары как "асинхронный - неконсистентный". Возможно в 
лекцию стоит включить этот маркер... 
```

## Задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

```answer3
Сама идеология у них разная (упор на консистентные данные в ACID и 
"главное скорость, а данные могут быть и с ошибкой" в BASE) - так что 
в чистом виде они не могут быть в реализации одновременно в одной и 
той же системе.
```

## Задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни
- реакция на истечение таймаута

Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). 
Что это за система? Какие минусы выбора данной системы?

```answer4
Это Redis - key-value БД, которая поддерживает работу с publishers / 
subscrivers. Минусами этой системы можно назвать:
1) Работает в памяти - сохранение данных требует отдельных усилий, а 
после "холодного" перезапуска может потребоваться некоторое время на 
"прогрев" БД нужными значениями. При этом аварийное завершение работы 
сервиса значит скорее всего потерю данных.
2) Все, что работает в памяти (ОЗУ) - страдает/упирается в ее нехватку.
Если памяти не хватает для ваших данных, то вы просто не сможете 
использовать эту систему.
3) Redis - NoSQL, то есть нельзя вытащить "сложным" запросом искомые 
данные. Это недостаток только если в случае, если "неправильно" 
использовать систему - всему свое предназначение, как мне кажется. Не 
нужно пытаться решить все на свете проблемы при помощи только одного 
инструмента.
4) Нашел упоминание, что Redis имеет ограниченные возможности по 
обеспечениб безопасности, разграничения доступа. Подразумевается, что 
с этой системой, в первую очередь, работают только "доверенные клиенты" 
и нет возможности гранулярной настройки доступа к объектам, как в 
традиционных базах данных - работа осуществляется с использованием 
команд и авторизованный клиент получает доступ к ним.
5) Нет встроенной защиты от "NoSQL injection" - то есть входящие 
запросы никак не проверяются и не защищены от злоумышленников, которые 
могут "подобрать" правильные запросы для получения "лишних" данных или 
вовсе выполнения "других" команд к сервису, нежели чем подразумевается 
владельцами ресурса.
6) Возможность внутренними командами Redis изменить такие 
конфигурационные параметры, как "рабочая директория" сервиса и 
записывать дампы в случайные файлы - то есть злоумышленник может 
записывать произвольные данные в файловой структуре сервера (куда 
допустимо писать сервису Redis), что может вывети систему из строя 
или вовсе подменить ключевые конфигурационные файлы, например - при 
этом даже не требуется выполнять хитроумные манипуляции для 
переполнения стека и т.п. Поэтому важно ограничивать набор доступных 
к выполнению команд у сервиса (по умолчанию можно выполнять все 
команды) и не запускать сам сервис от root-пользователя.

И да, формулировку задания надо как-то поменять - возможно понять как 
и что следует отвечать только если посмотреть конкретно что об этом 
задании говорила лектор. 
```

---

